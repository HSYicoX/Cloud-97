
# 用户头像功能说明

## 现有实现

头像功能已经集成到现有的 `users` 数据模型中：

### 数据模型字段
- **avatar** (Image类型): 存储用户头像的URL
- **updatedAt** (系统字段): 记录头像最后更新时间

### 功能特性
1. **文件验证**: 支持图片格式验证（仅 image/* 类型）
2. **大小限制**: 文件大小限制为5MB
3. **实时预览**: 上传前支持图片预览
4. **云存储集成**: 使用云开发云存储服务保存头像文件
5. **数据持久化**: 头像URL保存到 users 数据模型的 avatar 字段

### 技术实现
- 使用 `FileReader` API 实现客户端预览
- 通过 `$w.cloud.getCloudInstance()` 获取云开发实例
- 使用云存储的 `uploadFile` 和 `getTempFileURL` 方法
- 更新 `users` 数据模型的 `avatar` 字段

## 使用方式

头像功能已经在 profile.jsx 页面中完整实现，用户可以通过：
1. 点击头像区域触发文件选择
2. 选择图片文件进行预览
3. 确认上传后保存到数据库
4. 自动更新页面显示的新头像

## 数据存储

头像数据存储在现有 users 数据模型中，不需要创建单独的数据模型：
- 头像URL: `avatar` 字段
- 上传时间: `updatedAt` 系统字段
- 用户标识: `_id` 系统字段

这样设计避免了数据冗余，保持了数据的一致性。
  